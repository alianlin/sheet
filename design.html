<!DOCTYPE html>
<html lang="en">

<head>
     <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WGWNDDQ');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, shrink-to-fit=no">
    <title>ALian | Portfolio - APP</title>
    <meta name="keywords" content="Portfolio,ALian Lin,ALian,A-Lian,林阿蓮,阿蓮,UI,Designer,Web Designer" />
    <meta name="description" content="ALian Lin is a UI Designer,with 10 years of experience in design, digital, and marketing." />
    <meta property="og:title" content="ALian Lin | Portfolio" />
    <meta property="og:description" content="ALian Lin is a UI Designer,with 10 years of experience in design, digital, and marketing." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://alian-design.com" />
    <meta property="og:image" content="https://alian-design.com/images/share.jpg" />
    <meta property="og:image:url" content="https://alian-design.com/images/share.jpg" />
    <link rel="icon" href="https://alian-design.com/ALian/images/favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.css" />
    <link rel="stylesheet" href="css/grid.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.3.2/lazysizes.min.js"></script>
    <script src="https://s3-ap-northeast-1.amazonaws.com/justfont-user-script/jf-64282.js"></script>
</head>
<body class="page" id="design">
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WGWNDDQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <header class="header" id="header">
    </header>
    <div class="section_kv kv_page  kv_design">
       <div class="container">
            <h1 class="title">
                <p>Design</p>
            </h1>
       </div>
        <div class="kv_bg">
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_circle"></div>
            <div class="bg_lin" ></div>
            <div class="bg_lin" ></div>
            <div class="bg_lin"></div>
        </div>
    </div>
    <section class="section_page design_page">
        <div class="container container_tab">
            <div class="row">
              <a v-for="tab in categories"
                :key="tab"
                href="javascript:void(0);"
                :class="['btn_tab', { 'is-active': currentCategory === tab }]"
                @click="changeTab(tab)">
                <span>{{ tab }}</span>
                </a>
            </div>
        </div>
        <div id="loading" v-show="isLoading" class="is-active">
            <div class="loading_bar">
                <div class="loading_text"><p>Loading</p></div>
                <div class="loading_circle"></div>
            </div>
        </div>
        <div class="container container_design">
            <!-- 搜尋 -->
            <div class="search_area">
                <select class="label_input label_select label_year" v-model="selectedYear">
                    <option value="">選擇年份</option> <!-- 預設選項，value 為空字串 -->
                    <option v-for="year in availableYears" :key="year" :value="year">
                    {{ year }}
                    </option>
                </select>
                <span class="line"></span>
                <input class="label_input"
                    type="text"
                    v-model="searchInput"
                    @keyup.enter="doSearch"
                    placeholder="search" >
                <button class="label_btn bt btn_arrow" @click="doSearch">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30">
                        <path d="M10 23.5 20.035 15 10 6"/>
                    </svg>
                </button>
            </div>
            <!-- 圖文顯示 -->
            <div class="info_area info_project">
                <div class="row row_content" v-for="item in pagedProjects" :key="item.id">
                    <div class="col-12 col-md-55">
                        <div class="item item_pic" data-aos="fade">
                            <img :src="`images/${path}/pic_${item.id}.jpg`" :alt="item.title" />
                        </div>
                    </div>
                    <div class="col-12 col-md-55" >
                        <div class="item item_info" data-aos="fade-up">
                            <h2 class="info_title" v-if="item.title.length">
                                <p>{{ item.title }}</p>
                            </h2>
                            <div class="info_tag" v-if="item.year.length">
                                <span v-if="item.category.length" class="tag">{{ item.category }}</span>
                                <span v-if="item.client.length" class="tag">{{ item.client }}</span>
                                <span v-if="item.year.length" class="tag">{{ item.year }}</span>
                            </div>
                            <h5 class="info_content">
                                <p v-html="item.description">{{ item.description }}</p>
                                <p v-if="item.responsibilities.length">
                                    負責項目：{{ item.responsibilities.join('、') }}
                                </p>
                            </h5>
                            <div class="info_more">
                                <a v-if="item.link" :href="item.link" class="btn_more info_more" target="_blank" rel="noopener">
                                    <span class="text">more</span>
                                    <span class="circle">
                                        <img class="arrow" src="images/btn_arrow_s.svg" alt="scroll down">
                                    </span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="pagination_content" v-if="totalPages > 1">
                <button class="btn_arrow pagination_arrow arrow_left" @click="currentPage--" :disabled="currentPage === 1">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30">
                        <path d="M20.035 23.5 10 15l10.035-9"/>
                    </svg>
                </button>
                 <span>{{ currentPage }} / {{ totalPages }}</span>
                 <button class="btn_arrow pagination_arrow arrow_right" @click="currentPage++" :disabled="currentPage === totalPages">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 30 30">
                        <path d="M10 23.5 20.035 15 10 6"/>
                    </svg>
                 </button>
            </div>
        </div>
    </section>
    <div id="footer"></div>
    <a class="btn_more btn_top" href="javascript:void(0);" data-aos="kv-fadeOut" data-aos-anchor=".kv_scroll-fadeOut">
        <span class="text">TOP</span>
        <span class="circle">
            <img class="arrow" src="images/btn_arrow_sw.svg" alt="top">
        </span>
    </a>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@8/swiper-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script src="js/mold.js"></script>
    <script type="module">
import {
  createApp,
  ref,
  onMounted,
  watch,
  nextTick
} from 'https://cdn.jsdelivr.net/npm/vue@3.2.47/dist/vue.esm-browser.prod.js';

import { useFetchData } from './js/useFetchData.js';
import { usePagination } from './js/usePagination.js';
import { initJustfont } from './js/useJustfont.js';

createApp({
  setup() {
    const isLoading = ref(true);

    const {
      categories,
      currentCategory,
      projects,
      path,
      fetchData
    } = useFetchData();

    const {
      currentPage,
      totalPages,
      pagedProjects,
      availableYears,
      selectedYear,
      searchInput,
      doSearch,
    } = usePagination(projects);

    const changeTab = (tab) => {
      if (currentCategory.value === tab) return;
      isLoading.value = true;
      currentCategory.value = tab;
      currentPage.value = 1;
      searchInput.value = '';
      selectedYear.value = '';
      window.scrollTo({ top: 0, behavior: 'smooth' });
      window.location.hash = `#${tab}`;
    };

    //modal
    const showModal = ref(false);        // 控制是否顯示 modal
    const modalItem = ref(null);         // 儲存點擊的項目資料
    const openModal = (item) => {
    modalItem.value = item;
    showModal.value = true;
    };
    const closeModal = () => {
    showModal.value = false;
    modalItem.value = null;
    };


    // ✅ 監聽網址 hash，確保 tab 狀態一致
    window.addEventListener('hashchange', () => {
      const hash = decodeURIComponent(window.location.hash.replace('#', '')).toLowerCase();
      const match = categories.value.find(name => name.toLowerCase() === hash);
      if (match && match !== currentCategory.value) {
        currentCategory.value = match;
        console.log('🔁 hashchange → 切換 tab:', match);
      }
    });

    // ✅ 當 categories 初次載入後，根據 hash 切換 tab
    watch(categories, () => {
      const hash = decodeURIComponent(window.location.hash.replace('#', '')).toLowerCase();
      const match = categories.value.find(name => name.toLowerCase() === hash);
      if (match) {
        currentCategory.value = match;
        console.log('📌 初次載入根據 hash 切換 tab:', match);
      }
    }, { immediate: true });

    onMounted(async () => {
      isLoading.value = true;
      await fetchData();     // 先抓 tabs
      await nextTick();      // 等畫面更新
      initJustfont();        // 套用字體
      isLoading.value = false;
    });

    // 當 currentCategory 改變時，自動載入資料並顯示 loading 畫面
    watch(currentCategory, async () => {
      isLoading.value = true;
      await nextTick();
      isLoading.value = false;
    });

    return {
      isLoading,
      categories,
      currentCategory,
      projects,
      path,
      currentPage,
      totalPages,
      pagedProjects,
      changeTab,
      searchInput,
      availableYears,
      selectedYear,
      doSearch,
      showModal,
      modalItem,
      openModal,
      closeModal,
    };
  }
}).mount('#design');
</script>
</body>

</html>
